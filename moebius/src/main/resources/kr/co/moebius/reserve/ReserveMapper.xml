<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.moebius.reserve.ReserveMapper">
	
	<!-- 스크린네임 가져오는거 -->
	<select id="getScreenName" parameterType="int" resultType="String">
		select screen_name from m_screen
		WHERE screen_no = #{screen_no}
	</select>
	
	<!-- 좌석번호 가져오는거 -->
	<select id="getSeatno" parameterType="String" resultType="int">
		select seat_no from m_seat
		WHERE seat_name = #{seatName}
	</select>
	
	<!-- 예약누르면 예약하는거임 -->
	<insert id="insertReserve" parameterType="SitVO" >
			INSERT INTO m_reserve(
						user_id,
						screen_no,
						reserve_no,
						seat_no,
						seat_name)
			VALUES(
					#{user_id},#{screen_no},seq_reserve_no.nextval,#{seat_no},#{seat_name}
			)
	</insert>
	
	<!-- 예매 여부 확인  -->
	<select id="count" parameterType="SitVO" resultType="int">
		select count(*) AS cnt
		FROM m_reserve r JOIN m_screen s
		ON r.screen_no = s.screen_no
		WHERE r.seat_name=#{seat_name} AND s.screen_name = #{screen_name} 
		      AND s.location_no = #{location_no} AND s.movie_no = #{movie_no} 
	</select>


	<update id="updateReserveCount" parameterType="int">
		UPDATE m_movie SET movie_count = movie_count + 1
		WHERE movie_no = #{movie_no}
	</update>
	
	<update id="updateStatus" parameterType="SitVO">
		UPDATE m_user
		SET user_status = user_status + 1
		WHERE user_id = #{user_id}		
	</update>


	<select id="getReservedSeat" parameterType="int" resultType="String">
		SELECT sit.seat_name
		FROM m_seat sit JOIN m_reserve re
		ON sit.seat_no = re.seat_no
		WHERE re.screen_no = #{screen_no}
	</select>
	
	

	
</mapper>