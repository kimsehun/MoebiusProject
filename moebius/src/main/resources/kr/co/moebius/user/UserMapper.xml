<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper      
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"      
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.moebius.user.UserMapper">
	<!-- 회원가입 -->
	<insert id="registUser" parameterType="UserVO" >
	INSERT INTO m_user(
				user_id,user_name,user_pwd,user_pwd_ok,user_age,user_pwd_hint,user_pwd_answer,
				user_gender,user_jumin1,user_jumin2,user_email,user_phone,user_zipcode,
				user_addr1,user_addr2)
	VALUES(		
				#{user_id},#{user_name},#{user_pwd},#{user_pwd_ok},#{user_age},#{user_pwd_hint},#{user_pwd_answer},
				#{user_gender},#{user_jumin1},#{user_jumin2},#{user_email},#{user_phone},#{user_zipcode},
				#{user_addr1},#{user_addr2})
	</insert>
	
	<!-- zipcode 리스트 불러오기 -->
	<select id="searchZipcode" resultType="ZipcodeVO" parameterType="String" >
	SELECT substr(zipcode, 1, 3) AS zipcode1,
	   substr(zipcode, 5, 3) AS zipcode2,
	   trim(sido || ' ' || gugun || ' ' || dong || ' ' ||
	   ri || ' ' || bunji) AS addr1
	FROM zipcode
	WHERE dong like '%' || #{area} || '%'
	</select>
	
	<!-- id 중복 체크 -->
	<select id="idCheck" resultType="int" parameterType="String">
	SELECT count(*) AS cnt
	FROM m_user
	WHERE user_id = #{user_id}
	</select>
	
	<!-- 주민번호 중복 체크 -->
	<select id="Check" resultType="int" parameterType="UserVO">
	SELECT count(*) AS cnt
	FROM m_user
	WHERE user_jumin1=#{user_jumin1} AND user_jumin2=#{user_jumin2} AND user_name=#{user_name}
	</select>
	
	<!-- 로그인 -->
	<select id="getUser" resultType="UserVO" parameterType="UserVO">
	SELECT user_id, user_name FROM m_user
	WHERE user_id=#{user_id} AND user_pwd=#{user_pwd}
	</select>

	<!-- 회원탈퇴 -->
	<delete id="deleteUser" parameterType="UserVO" >
	DELETE FROM m_user
	WHERE user_id=#{user_id} AND user_pwd=#{user_pwd}
	</delete>
	
	<!-- 회원 수정시 회원 정보 가져오기 -->
	<select id="getUserInfo" resultType="UserVO" parameterType="UserVO">
	SELECT	user_id,user_name,user_pwd,user_pwd_ok,user_pwd_hint,user_pwd_answer,
			user_email,user_phone,user_zipcode,
			user_addr1,user_addr2
	FROM m_user
	WHERE user_id=#{user_id}
	</select>
	
	<!-- 회원 정보 수정 -->
	<update id="updateUser" parameterType="UserVO" >
	UPDATE m_user
	SET user_phone=#{user_phone}, user_email=#{user_email}, user_pwd_answer=#{user_pwd_answer},
		user_zipcode=#{user_zipcode}, user_addr1=#{user_addr1}, user_addr2=#{user_addr2}
	WHERE user_pwd=#{user_pwd} AND user_id=#{user_id}
	</update>
	
	<!-- email 주소 받아오기 -->
	<select id="emailaddr" parameterType="String" resultType="UserVO">
	SELECT user_email
	FROM m_user
	WHERE user_id=#{user_id}
	</select>
	
	<!-- 아이디 찾기 -->
	<select id="searchId" resultType="UserVO" parameterType="UserVO">
	SELECT user_id,user_email,user_name
	FROM m_user
	WHERE user_jumin1=#{user_jumin1} AND user_jumin2=#{user_jumin2} AND user_name=#{user_name}
	</select>
	
	<!-- 비밀번호 찾기 -->
	<select id="searchPwd" resultType="UserVO" parameterType="UserVO">
	SELECT user_pwd_ok, user_name, user_email
	FROM m_user
	WHERE user_pwd_hint=#{user_pwd_hint} AND user_pwd_answer=#{user_pwd_answer}	
	</select>
	
	<!-- 회원가입 중복 방지를 위한 주민번호 체크 -->
	<select id="searchJumin">
	SELECT count(*) AS cnt
	FROM m_user
	WHERE user_jumin1=#{user_jumin1} AND user_jumin2=#{user_jumin2} AND user_name=#{user_name}
	</select>
	
	<!-- 비밀번호 변경 시 기존 비밀번호 가져오는거 -->
	<select id="getPwd" resultType="String" parameterType="InfoVO">
	SELECT user_pwd
	FROM m_user
	</select>
	
	<!-- 비밀번호 수정 -->
	<update id="changePwd" parameterType="InfoVO" >
	UPDATE m_user
	SET user_pwd=#{new_pwd}, user_pwd_ok=#{new_pwd_ok}
	WHERE user_id=#{user_id} AND user_pwd=#{user_inpwd}
	</update>
	
	<update id="pointUp" parameterType="String">
	UPDATE m_user SET
	user_point = user_point + 5000
	WHERE user_id=#{user_id}
	</update>
</mapper>
